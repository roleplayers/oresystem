<div class="attributes-container">
  <!-- Single header for all attributes -->
  <div class="attributes-single-header">
    <div class="item-name">Name <small>(Drag to reorder)</small></div>
    <div class="item-dice-pools">Dice Pools</div>
    <div class="item-controls">
      <a class="item-control item-create" title="Create item" data-type="skill"><i class="fas fa-plus"></i> Add item</a>
    </div>
  </div>

  <!-- Two column layout with drag & drop -->
  <div class="attributes-two-columns">
    <!-- Primeira coluna -->
    <div class="attributes-column" data-column="left">
      {{#each leftColumnStats as |statName index|}}
        {{#each ../sortedSkills as |skillGroup groupStatName|}}
          {{#if (eq groupStatName statName)}}
          <div class="stat-group" data-stat="{{statName}}" data-position="{{add index index}}">
            <div class="drop-indicator top"></div>
            <ol class="items-list">
              {{!-- Show the stat first --}}
              {{#each ../../stats as |stat|}}
                {{#if (eq stat.name statName)}}
                <li class="item flexrow stat-row draggable-stat" 
                    data-item-id="{{stat._id}}" 
                    data-stat-name="{{stat.name}}"
                    draggable="true">
                  <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
                  <div class="item-name">
                    <div class="item-image">
                      <a class="rollable" data-roll-type="item"><img src="{{stat.img}}" title="{{stat.name}}" width="30" height="30"/></a>
                    </div>
                    <h2>{{stat.name}}</h2>
                  </div>
                  <div class="item-dice-pools">
                    <div class="dice-pool-section">
                      <label>D:</label>
                      <div class="dice-checkboxes">
                        {{#numLoop stat.system.d}}
                        <span class="dice-box filled">☐</span>
                        {{/numLoop}}
                      </div>
                    </div>
                    <div class="dice-pool-section">
                      <label>E:</label>
                      <div class="dice-checkboxes">
                        {{#numLoop stat.system.ed}}
                        <span class="dice-box filled">☐</span>
                        {{/numLoop}}
                      </div>
                    </div>
                    <div class="dice-pool-section">
                      <label>M:</label>
                      <div class="dice-checkboxes">
                        {{#numLoop stat.system.md}}
                        <span class="dice-box filled">☐</span>
                        {{/numLoop}}
                      </div>
                    </div>
                  </div>
                  <div class="item-controls">
                    <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
                    <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
                  </div>
                </li>
                {{/if}}
              {{/each}}
              
              {{!-- Then show skills for this stat --}}
              {{#each skillGroup as |item|}}
              <li class="item flexrow skill-row" data-item-id="{{item._id}}">
                <div class="skill-spacer"></div>
                <div class="item-name">
                  <div class="item-image">
                    <a class="rollable" data-roll-type="item"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></a>
                  </div>
                  <h4>{{item.name}}</h4>
                </div>
                <div class="item-dice-pools">
                  <div class="dice-pool-section">
                    <label>D:</label>
                    <div class="dice-checkboxes">
                      {{#numLoop item.system.d}}
                      <span class="dice-box filled">☐</span>
                      {{/numLoop}}
                    </div>
                  </div>
                  <div class="dice-pool-section">
                    <label>E:</label>
                    <div class="dice-checkboxes">
                      {{#numLoop item.system.ed}}
                      <span class="dice-box filled">☐</span>
                      {{/numLoop}}
                    </div>
                  </div>
                  <div class="dice-pool-section">
                    <label>M:</label>
                    <div class="dice-checkboxes">
                      {{#numLoop item.system.md}}
                      <span class="dice-box filled">☐</span>
                      {{/numLoop}}
                    </div>
                  </div>
                </div>
                <div class="item-controls">
                  <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
                </div>
              </li>
              {{/each}}
            </ol>
            <div class="drop-indicator bottom"></div>
          </div>
          {{/if}}
        {{/each}}
      {{/each}}
    </div>

    <!-- Segunda coluna -->
    <div class="attributes-column" data-column="right">
      {{#each rightColumnStats as |statName index|}}
        {{#each ../sortedSkills as |skillGroup groupStatName|}}
          {{#if (eq groupStatName statName)}}
          <div class="stat-group" data-stat="{{statName}}" data-position="{{add (add index index) 1}}">
            <div class="drop-indicator top"></div>
            <ol class="items-list">
              {{!-- Show the stat first --}}
              {{#each ../../stats as |stat|}}
                {{#if (eq stat.name statName)}}
                <li class="item flexrow stat-row draggable-stat" 
                    data-item-id="{{stat._id}}" 
                    data-stat-name="{{stat.name}}"
                    draggable="true">
                  <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
                  <div class="item-name">
                    <div class="item-image">
                      <a class="rollable" data-roll-type="item"><img src="{{stat.img}}" title="{{stat.name}}" width="30" height="30"/></a>
                    </div>
                    <h2>{{stat.name}}</h2>
                  </div>
                  <div class="item-dice-pools">
                    <div class="dice-pool-section">
                      <label>D:</label>
                      <div class="dice-checkboxes">
                        {{#numLoop stat.system.d}}
                        <span class="dice-box filled">☐</span>
                        {{/numLoop}}
                      </div>
                    </div>
                    <div class="dice-pool-section">
                      <label>E:</label>
                      <div class="dice-checkboxes">
                        {{#numLoop stat.system.ed}}
                        <span class="dice-box filled">☐</span>
                        {{/numLoop}}
                      </div>
                    </div>
                    <div class="dice-pool-section">
                      <label>M:</label>
                      <div class="dice-checkboxes">
                        {{#numLoop stat.system.md}}
                        <span class="dice-box filled">☐</span>
                        {{/numLoop}}
                      </div>
                    </div>
                  </div>
                  <div class="item-controls">
                    <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
                    <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
                  </div>
                </li>
                {{/if}}
              {{/each}}
              
              {{!-- Then show skills for this stat --}}
              {{#each skillGroup as |item|}}
              <li class="item flexrow skill-row" data-item-id="{{item._id}}">
                <div class="skill-spacer"></div>
                <div class="item-name">
                  <div class="item-image">
                    <a class="rollable" data-roll-type="item"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></a>
                  </div>
                  <h4>{{item.name}}</h4>
                </div>
                <div class="item-dice-pools">
                  <div class="dice-pool-section">
                    <label>D:</label>
                    <div class="dice-checkboxes">
                      {{#numLoop item.system.d}}
                      <span class="dice-box filled">☐</span>
                      {{/numLoop}}
                    </div>
                  </div>
                  <div class="dice-pool-section">
                    <label>E:</label>
                    <div class="dice-checkboxes">
                      {{#numLoop item.system.ed}}
                      <span class="dice-box filled">☐</span>
                      {{/numLoop}}
                    </div>
                  </div>
                  <div class="dice-pool-section">
                    <label>M:</label>
                    <div class="dice-checkboxes">
                      {{#numLoop item.system.md}}
                      <span class="dice-box filled">☐</span>
                      {{/numLoop}}
                    </div>
                  </div>
                </div>
                <div class="item-controls">
                  <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
                </div>
              </li>
              {{/each}}
            </ol>
            <div class="drop-indicator bottom"></div>
          </div>
          {{/if}}
        {{/each}}
      {{/each}}
    </div>
  </div>
</div>

<style>
.attributes-container {
  width: 100%;
}

.attributes-two-columns {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-top: 10px;
}

.attributes-column {
  min-width: 0;
}

.stat-group {
  position: relative;
  margin-bottom: 15px;
}

.items-list {
  margin: 0;
}

/* DRAG & DROP STYLING */
.drag-handle {
  width: 20px;
  padding: 5px;
  color: #999;
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: color 0.2s ease;
}

.drag-handle:hover {
  color: #8b0000;
}

.draggable-stat {
  border: 2px solid transparent;
  transition: all 0.2s ease;
}

.draggable-stat.dragging {
  opacity: 0.5;
  transform: scale(0.95);
  border-color: #8b0000;
  box-shadow: 0 4px 8px rgba(139, 0, 0, 0.3);
}

.drop-indicator {
  height: 3px;
  background: transparent;
  transition: all 0.2s ease;
  margin: 2px 0;
  border-radius: 2px;
}

.drop-indicator.active {
  background: #4caf50;
  box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
  height: 6px;
}

.stat-group.drag-over {
  background: rgba(76, 175, 80, 0.1);
  border-radius: 4px;
}

/* CONTROLES VISÍVEIS */
.oresystem .items-list .item {
  position: relative;
  padding-right: 130px; /* Mais espaço para drag handle */
}

.oresystem .items-list .item-controls {
  position: absolute;
  right: 5px;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0;
  transition: opacity 0.2s ease;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 3px;
  padding: 2px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  display: flex;
  gap: 5px;
}

.oresystem .items-list .item:hover .item-controls {
  opacity: 1;
}

.oresystem .items-list .item-controls a {
  font-size: 12px;
  color: #666;
  padding: 2px 4px;
  border-radius: 2px;
  transition: all 0.2s ease;
}

.oresystem .items-list .item-controls a:hover {
  color: #8b0000;
  background: rgba(139,0,0,0.1);
}

.skill-spacer {
  width: 20px; /* Alinha skills com stats */
  flex-shrink: 0;
}

/* Responsive */
@media (max-width: 768px) {
  .attributes-two-columns {
    grid-template-columns: 1fr;
    gap: 10px;
  }
}

/* Visual feedback para drag */
.attributes-container.dragging-active .stat-group:not(.drag-over) {
  opacity: 0.7;
}

.attributes-container.dragging-active .drop-indicator {
  background: rgba(76, 175, 80, 0.3);
  height: 4px;
}
</style>